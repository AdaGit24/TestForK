<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="Ada">
    <meta name="description" content="Pedro Pablo Store">
<title>Pedro Pablo Store</title>
<link rel="icon" href="html5.png" type="image/x-icon">
<link rel="stylesheet" href="main.css" type="text/css">
<script src="https://js.khipu.com/v1/kws.js"></script>

<script language="JavaScript" type="module">
    const id = '498906';
    const respuesta = await fetch(
        `https://payment-api.khipu.com/v3/merchants/${id}/paymentMethods`,
        {
            method: 'GET',
            headers: {
                'x-api-key': '73f7f7da-9a1f-4989-83bc-cb32b039d05d'
            }
        }
    );

    const dataPM = await respuesta.text();
    console.log(dataPM);
</script>

</head>

<body>
    <h1>Hello Khipu World!</h1>
    <h2>Testing Khipu REST API</h2>
    <p>Open Finance & Open Banking Payments Company</p>
    <p>It has been a while since i havent done coding... More or less 20 years</p>

    <hr> <!-- horizontal rule does not need clossing tag - -->
      
<div id="khipu-web-root">

    <script type="module">

        /*descriptor de pago
           const resp = await fetch(`https://api.khipu.com/v1/descriptor/payment`,
               {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                       'x-api-key': '73f7f7da-9a1f-4989-83bc-cb32b039d05d'
       
                   },
                   body: JSON.stringify
                       (
                           {
                               bank: "Bofa",
                               params:
                               {
                                   "subject": "Prueba Descriptor de Pago en Khipu",
                                   "ammount": "5000",
                                   "currency_code": "CLP",
                                   "payer_email": "test1@gmail.com",
                                   "payer_name": "OlgaTest1",
                                   "target_account_bank": "DemoBank",
                                   "target_account_alias": "CC1",
                                   "target_account_name": "Pedro Pablo",
                                   "target_account_number": "0000000000000546271",
                                   "target_account_personal_identifier": "4.905.113-1"
                               }
                           }
                       )
               }
           );
           const data = await resp.json();
           console.log(data);
       */
        //create payment 
        const resp = await fetch(
            `https://payment-api.khipu.com/v3/payments`,
            {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': '73f7f7da-9a1f-4989-83bc-cb32b039d05d'
                },
                body: JSON.stringify({
                    amount: 5000,
                    currency: 'CLP',
                    subject: 'Cobro de prueba'
                })
            }
        );

        const dataPago = await resp.json();
        console.log(dataPago);




        const callback = (result) => {
            console.log(`calback invoked:`, result);
        };

        const options = {
            mountElement: document.getElementById('khipu-web-root'),
            modal: true,
            modalOptions: {
                maxWidth: 450,
                maxHeight: 860,
            },
            options: {
                style: {
                    primaryColor: '#8347AD',
                    fontFamily: 'Roboto',
                },
                skipExitPage: false,
            },
        }

        const khipu = new Khipu();
        khipu.startOperation(dataPago.payment_id, callback, options);

    </script>

    <hr> <!-- horizontal rule does not need clossing tag - -->
</div>

       
       &lt;&lt;&lt; &copy; Ada 2025 &gt;&gt;&gt;  
</body>

</html>